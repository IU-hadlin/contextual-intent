# CLAUDE.md

æœ¬æ–‡ä»¶ä¸º Claude Code æä¾›åœ¨æ­¤ä»£ç åº“ä¸­å·¥ä½œçš„æŒ‡å¯¼ã€‚

---

## ç”¨æˆ·ç‰¹å®šæŒ‡ä»¤ï¼ˆåŠ¡å¿…éµå®ˆï¼‰

**ç§°å‘¼ä¸äº¤äº’æ–¹å¼**ï¼š
- æ¯æ¬¡å›ç­”å¿…é¡»ä»¥"é˜¿ç‚œ"ç§°å‘¼ç”¨æˆ·
- æ‰§è¡Œå…³é”®å‘½ä»¤æˆ–ä»£ç æ—¶ï¼Œå…ˆè§£é‡ŠåŸå› å’Œé¢„æœŸæ•ˆæœï¼Œç„¶åè®©é˜¿ç‚œè‡ªå·±æ‰§è¡Œ
- æ‰€æœ‰äº¤æµä½¿ç”¨ä¸­æ–‡
- ä¼˜å…ˆå¸®åŠ©ç†è§£ä»£ç æ¶æ„å’ŒåŸç†ï¼Œè€Œéç®€å•æ‰§è¡Œå‘½ä»¤
- é‡åˆ°æŠ¥é”™æ—¶ï¼Œå¿…é¡»åˆ†ææ ¹æœ¬åŸå› å¹¶è§£é‡ŠæŠ€æœ¯åŸç†

---

## é¡¹ç›®èƒŒæ™¯

**é¡¹ç›®åç§°**ï¼šSTITCHï¼ˆStructured Intent Tracking in Contextual Historyï¼‰+ CAME-Bench

**é¡¹ç›®å®šä½**ï¼šæ™ºèƒ½ä½“è®°å¿†ç³»ç»Ÿï¼Œç”¨äºå¯¹è¶…é•¿å¤šè½®å¯¹è¯è¿›è¡Œç»“æ„åŒ–ä¸»é¢˜æ ‡æ³¨å’Œæ„å›¾è¿½è¸ª

**å­¦ä¹ ç›®æ ‡**ï¼šä¸º AIæ•°æ®å›¢é˜Ÿ-æ•°æ®ç­–ç•¥å·¥ç¨‹å¸ˆ å²—ä½é¢è¯•åšå‡†å¤‡ï¼Œé‡ç‚¹å±•ç¤ºï¼š
1. å·¥ç¨‹æ¶æ„èƒ½åŠ› - ç†è§£å’Œè·‘é€šå¤æ‚å¼€æºé¡¹ç›®
2. æŠ€æœ¯è°ƒç ”èƒ½åŠ› - æ·±å…¥ç†è§£æ™ºèƒ½ä½“è®°å¿†ã€å¤šè½®å¯¹è¯æŠ€æœ¯

**å‚è€ƒèµ„æ–™**ï¼š
- è®ºæ–‡ï¼šhttps://arxiv.org/abs/2601.10702
- ç½‘ç«™ï¼šhttps://contextual-intent.github.io
- æ•°æ®é›†ï¼šhttps://huggingface.co/datasets/Seattleyrz/CAME-Bench

---

## æŠ€æœ¯æ ˆ

- **Python**ï¼š3.11.9ï¼ˆè™šæ‹Ÿç¯å¢ƒ `.venv`ï¼‰
- **Protocol Buffers**ï¼šæ•°æ®ç»“æ„å®šä¹‰å’Œåºåˆ—åŒ–
- **Qdrant**ï¼šå‘é‡æ•°æ®åº“ï¼ˆéƒ¨ç½²åœ¨ `http://101.126.29.2:6333`ï¼‰
- **LLM æä¾›å•†**ï¼šDashScopeï¼ˆé˜¿é‡Œäº‘ qwen-plus æ¨¡å‹ï¼Œé€šè¿‡ OpenAI å…¼å®¹æ¥å£ï¼‰
- **æ¡†æ¶**ï¼šDSPyï¼ˆLLM ç¼–æ’ï¼‰ã€litellmï¼ˆç»Ÿä¸€ LLM æ¥å£ï¼‰

---

## ç¯å¢ƒé…ç½®

### åˆå§‹åŒ–ç¯å¢ƒ

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ (Windows)
.venv\Scripts\activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# ç”Ÿæˆ Proto æ–‡ä»¶ï¼ˆå¿…é¡»å…ˆæ‰§è¡Œï¼‰
python scripts/generate_proto_universal.py
```

### ç¯å¢ƒå˜é‡ï¼ˆ`.env` æ–‡ä»¶ï¼‰

```bash
DASHSCOPE_API_KEY=sk-48654e818a354c83b8fe3d5a08e486b7
QDRANT_URL=http://101.126.29.2:6333
```

---

## å…³é”®å‘½ä»¤

### 1. è·‘é€š Benchmark ç¤ºä¾‹

```bash
python example_run_benchmark.py
```

**è¯´æ˜**ï¼šéªŒè¯ç¯å¢ƒé…ç½®ï¼Œæµ‹è¯• DashScope API å’Œæ•°æ®åŠ è½½ã€‚é»˜è®¤ä½¿ç”¨å ä½æ£€ç´¢å‡½æ•°ï¼Œå‡†ç¡®ç‡ä¸º 0%ï¼ˆé¢„æœŸè¡Œä¸ºï¼‰ã€‚

### 2. STITCH å®Œæ•´ Pipeline

Pipeline åˆ†ä¸º 7 ä¸ªé˜¶æ®µï¼Œå¿…é¡»æŒ‰é¡ºåºæ‰§è¡Œï¼ˆå‚è€ƒ `scripts/sample_run.sh`ï¼‰ï¼š

```bash
# é˜¶æ®µ 0: ç”Ÿæˆ Protoï¼ˆå‰ç½®æ­¥éª¤ï¼‰
python scripts/generate_proto_universal.py

# é˜¶æ®µ 2: ç¼–ç å¯¹è¯è½®æ¬¡ä¸ºå‘é‡
python -m method_stitch.dataset_process.encode_turns -c config/encode_config.json

# é˜¶æ®µ 1: ç”Ÿæˆæ•°æ®é›†æè¿°
python -m method_stitch.dataset_description -c config/dataset_description_config.json

# é˜¶æ®µ 3a: é¢„æµ‹ä¸Šä¸‹æ–‡èŒƒå›´
python -m method_stitch.turn_scope_generator \
  --config config/segment_level_note_maintainer_config.json \
  --overwrite

# é˜¶æ®µ 3b: ç”Ÿæˆæ®µè½çº§æ‘˜è¦
python -m method_stitch.segment_note_generator \
  --config config/segment_level_note_maintainer_config.json \
  --overwrite

# é˜¶æ®µ 3c: äº‹ä»¶ç±»å‹æ ‡æ³¨
python -m method_stitch.event_type_labeler \
  -c config/event_type_labeler_config.json \
  --overwrite

# é˜¶æ®µ 3d: ç”Ÿæˆè½®æ¬¡çº§ç»“æ„åŒ–ç¬”è®°
python -m method_stitch.turn_level_note_generator \
  -c config/turn_level_note_generator_config.json \
  --overwrite

# é˜¶æ®µ 4: åŸºäºæ ‡ç­¾çš„æ£€ç´¢
python -m method_stitch.label_based_context_retrieval \
  --config config/label_based_context_retrieval_config.json \
  --overwrite

# é˜¶æ®µ 5: æ£€ç´¢ç»“æœæ ¼å¼è½¬æ¢
python -m method_stitch.transform_retrieval_output \
  --config config/transform_retrieval_output_config.json

# é˜¶æ®µ 6: ç­”æ¡ˆç”Ÿæˆ
python -m method_stitch.run_answer_generator -c config/answer_generation_config.json

# é˜¶æ®µ 7: ç­”æ¡ˆè¯„ä¼°
python -m method_stitch.run_answer_evaluator -c config/answer_evaluation_config.json
```

---

## STITCH Pipeline æ¶æ„

### æ ¸å¿ƒæ€æƒ³

ä¼ ç»Ÿ RAG ç›´æ¥ç”¨å‘é‡ç›¸ä¼¼åº¦æ£€ç´¢ï¼Œåœ¨è¶…é•¿å¯¹è¯ä¸­ä¼šæ£€ç´¢åˆ°å¤§é‡ä¸ç›¸å…³å†…å®¹ã€‚STITCH çš„åˆ›æ–°ç‚¹æ˜¯**å…ˆè¿›è¡Œç»“æ„åŒ–æ ‡æ³¨ï¼Œå†åŸºäºæ ‡ç­¾è¿‡æ»¤+å‘é‡æ£€ç´¢**ã€‚

### æ•°æ®æµ

```
è¾“å…¥: turns.jsonl (å¯¹è¯è½®æ¬¡) + questions.jsonl (è¯„ä¼°é—®é¢˜)
  â”‚
  â”œâ”€ é˜¶æ®µ 2: å‘é‡ç¼–ç  â†’ Qdrant å‘é‡åº“
  â”œâ”€ é˜¶æ®µ 1: æ•°æ®é›†æè¿°ç”Ÿæˆ â†’ åŠŸèƒ½ç»†èŠ‚ç§å­
  â”‚
  â”œâ”€ é˜¶æ®µ 3: Intent Trackingï¼ˆSTITCH æ ¸å¿ƒï¼‰
  â”‚   â”œâ”€ 3a. é¢„æµ‹ä¸Šä¸‹æ–‡èŒƒå›´ (context_scope)
  â”‚   â”œâ”€ 3b. æ®µè½çº§æ‘˜è¦ (segment_level_notes)
  â”‚   â”œâ”€ 3c. äº‹ä»¶ç±»å‹æ ‡æ³¨ (event_types)
  â”‚   â””â”€ 3d. è½®æ¬¡çº§ç»“æ„åŒ–ç¬”è®° (act, target, scope, events)
  â”‚
  â”œâ”€ é˜¶æ®µ 4: æ ‡ç­¾æ£€ç´¢
  â”‚   â””â”€ é—®é¢˜ â†’ LLM é€‰æ‹©æ ‡ç­¾ â†’ è¿‡æ»¤å€™é€‰è½®æ¬¡ â†’ å‘é‡æ’åº â†’ top-k
  â”‚
  â””â”€ é˜¶æ®µ 5-7: æ ¼å¼è½¬æ¢ â†’ ç­”æ¡ˆç”Ÿæˆ â†’ è¯„ä¼°
```

### å…³é”®æ•°æ®ç»“æ„

**turns.jsonl** - å¯¹è¯è½®æ¬¡ï¼š
```json
{
  "id": "turn_1",
  "role": "user",
  "content": "I'm looking for a hotel in Tokyo.",
  "partition": ["conv_1"],
  "timestamp_mapping": {"conv_1": "2023-10-01T10:00:00Z"}
}
```

**questions.jsonl** - è¯„ä¼°é—®é¢˜ï¼š
```json
{
  "id": "q_1",
  "content": "What was the user's budget?",
  "type": "FREE_FORM",
  "answer": {"free_form_answer": "Under $200 per night"},
  "question_turn_ids": ["turn_5"],
  "answer_turn_ids": ["turn_2", "turn_3"]
}
```

---

## æ•°æ®é›†è¯´æ˜

CAME-Bench æä¾› 14 ä¸ª trajectoriesï¼Œåˆ†ä¸º 3 ç§è§„æ¨¡ï¼š

| Scale  | Trajectories       | Turn Range   | ç”¨é€”                |
|--------|-------------------|--------------|-------------------|
| Small  | traj-8 è‡³ traj-13 | 62-240 turns | å¿«é€Ÿæµ‹è¯•ï¼ˆæ¨èæ–°æ‰‹ï¼‰ |
| Medium | traj-2 è‡³ traj-7  | 312-1442     | å¹³è¡¡æµ‹è¯•            |
| Large  | traj-0, traj-1    | 912-4105     | å®Œæ•´è¯„ä¼°            |

**æˆæœ¬ä¼°ç®—ï¼ˆåŸºäº DashScope qwen-plusï¼‰**ï¼š
- traj-0 (912 turns)ï¼šçº¦ Â¥0.40 RMB
- traj-8 (62 turns)ï¼šçº¦ Â¥0.05 RMB

**å½“å‰è¿›åº¦**ï¼šæ­£åœ¨å¤„ç† traj-0ï¼ˆLarge è§„æ¨¡ï¼‰

---

## å·²ä¿®å¤çš„é—®é¢˜

### 1. Unicode ç¼–ç é—®é¢˜ï¼ˆWindows GBK é»˜è®¤ç¼–ç ï¼‰

**ç—‡çŠ¶**ï¼š`UnicodeDecodeError: 'gbk' codec can't decode byte...`

**ä¿®å¤ä½ç½®**ï¼š
- `came_bench/utils/io.py:156, 158, 168, 170` - æ‰€æœ‰ `open()` è°ƒç”¨æ·»åŠ  `encoding="utf-8"`

### 2. Proto å¯¼å…¥è·¯å¾„é”™è¯¯

**ç—‡çŠ¶**ï¼š`ModuleNotFoundError: No module named 'src'`

**ä¿®å¤ä½ç½®**ï¼š
- `method_stitch/dataset_process/encode_turns.py:28-32` - æ”¹ä¸º `from came_bench.proto import`

### 3. load_turns() å‡½æ•°ç­¾åä¸åŒ¹é…

**ç—‡çŠ¶**ï¼š`TypeError: load_turns() takes 1 positional argument but 2 were given`

**åŸå› **ï¼šå¤šä¸ªæ¨¡å—ä»åœ¨è°ƒç”¨æ—§ç‰ˆ API `load_turns(dataset_name, turns_path)`ï¼Œä½†æ–°ç‰ˆåªæ¥å— 1 ä¸ªå‚æ•°

**ä¿®å¤ä½ç½®**ï¼š
- `method_stitch/dataset_process/encode_turns.py:137`
- `method_stitch/turn_scope_generator.py:101`
- `method_stitch/segment_note_generator.py:137`
- `method_stitch/event_type_labeler.py:1042`

å…¨éƒ¨æ”¹ä¸ºï¼š`load_turns(turns_path)`

### 4. DashScope API é™æµ

**ç—‡çŠ¶**ï¼š`429 Too Many Requests`

**ä¿®å¤**ï¼š`config/encode_config.json` ä¸­ `max_concurrent` ä» 16 é™è‡³ 4

---

## é…ç½®æ–‡ä»¶è¯´æ˜

æ‰€æœ‰é…ç½®æ–‡ä»¶ä½äº `config/` ç›®å½•ï¼ŒåŸºäº `sample_config_files/` æ¨¡æ¿åˆ›å»ºï¼š

| é…ç½®æ–‡ä»¶                                  | ç”¨é€”            | å…³é”®å‚æ•°                          |
|----------------------------------------|---------------|-------------------------------|
| `encode_config.json`                   | é˜¶æ®µ 2 å‘é‡ç¼–ç     | max_concurrent, vector_size    |
| `dataset_description_config.json`      | é˜¶æ®µ 1 æ•°æ®é›†æè¿°   | sample_rate                    |
| `segment_level_note_maintainer_config.json` | é˜¶æ®µ 3a/3b     | scope_history_window           |
| `event_type_labeler_config.json`       | é˜¶æ®µ 3c äº‹ä»¶æ ‡æ³¨   | -                              |
| `turn_level_note_generator_config.json`| é˜¶æ®µ 3d ç¬”è®°ç”Ÿæˆ   | -                              |
| `label_based_context_retrieval_config.json` | é˜¶æ®µ 4 æ£€ç´¢   | top_k                          |
| `transform_retrieval_output_config.json`| é˜¶æ®µ 5 æ ¼å¼è½¬æ¢   | -                              |
| `answer_generation_config.json`        | é˜¶æ®µ 6 ç­”æ¡ˆç”Ÿæˆ    | max_tokens                     |
| `answer_evaluation_config.json`        | é˜¶æ®µ 7 ç­”æ¡ˆè¯„ä¼°    | -                              |

**é€šç”¨ LLM é…ç½®**ï¼ˆæ‰€æœ‰é˜¶æ®µå…±äº«ï¼‰ï¼š
```json
{
  "provider": "LANGUAGE_MODEL_PROVIDER_OPENAI",
  "model_name": "openai/qwen-plus",
  "temperature": 1.0,
  "max_tokens": 4096,
  "openai_config": {
    "api_key": "${DASHSCOPE_API_KEY}",
    "api_base": "https://dashscope.aliyuncs.com/compatible-mode/v1"
  }
}
```

---

## ç›®å½•ç»“æ„

```
contextual-intent/
â”œâ”€â”€ came_bench/                # Benchmark æ¡†æ¶
â”‚   â”œâ”€â”€ benchmark.py           # Benchmark ä¸»ç±»
â”‚   â”œâ”€â”€ data_process/          # æ•°æ®ä¸‹è½½å’Œè§£ç 
â”‚   â”œâ”€â”€ pipeline/              # ç­”æ¡ˆç”Ÿæˆå’Œè¯„ä¼°
â”‚   â””â”€â”€ utils/                 # å·¥å…·å‡½æ•°ï¼ˆlm, io, encoderï¼‰
â”‚
â”œâ”€â”€ method_stitch/             # STITCH ç®—æ³•å®ç°
â”‚   â”œâ”€â”€ dataset_description.py
â”‚   â”œâ”€â”€ dataset_process/encode_turns.py
â”‚   â”œâ”€â”€ turn_scope_generator.py
â”‚   â”œâ”€â”€ segment_note_generator.py
â”‚   â”œâ”€â”€ event_type_labeler.py
â”‚   â”œâ”€â”€ turn_level_note_generator.py
â”‚   â”œâ”€â”€ label_based_context_retrieval.py
â”‚   â””â”€â”€ segment_level_note_maintainer.py  # æ ¸å¿ƒç±»
â”‚
â”œâ”€â”€ proto/                     # Protobuf å®šä¹‰
â”‚   â”œâ”€â”€ project_dataset_uniform.proto
â”‚   â”œâ”€â”€ language_model_provider.proto
â”‚   â””â”€â”€ context_reduction_retrieval.proto
â”‚
â”œâ”€â”€ generated_proto/           # ç¼–è¯‘åçš„ Python ç±»
â”‚
â”œâ”€â”€ config/                    # é…ç½®æ–‡ä»¶ï¼ˆè‡ªå®šä¹‰ï¼‰
â”œâ”€â”€ stitch_output/             # Pipeline è¾“å‡º
â”œâ”€â”€ came_bench_data/decoded/   # è§£ç åçš„æ•°æ®é›†
â”‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ sample_run.sh          # å®Œæ•´ pipeline è„šæœ¬
â”‚   â””â”€â”€ generate_proto_universal.py
â”‚
â”œâ”€â”€ example_run_benchmark.py   # Benchmark ç¤ºä¾‹å…¥å£
â”œâ”€â”€ requirements.txt
â””â”€â”€ .env                       # ç¯å¢ƒå˜é‡
```

---

## å½“å‰å·¥ä½œè¿›åº¦

**å·²å®Œæˆé˜¶æ®µ**ï¼š
- âœ… é˜¶æ®µ 0: Proto ç”Ÿæˆ
- âœ… é˜¶æ®µ 2: å‘é‡ç¼–ç ï¼ˆ912 turns â†’ Qdrantï¼Œè€—æ—¶çº¦ 10 åˆ†é’Ÿï¼Œæˆæœ¬ Â¥0.003ï¼‰
- âœ… é˜¶æ®µ 1: æ•°æ®é›†æè¿°ï¼ˆç”Ÿæˆ 3.6KB æè¿°æ–‡ä»¶ï¼‰
- âœ… é˜¶æ®µ 3a: ä¸Šä¸‹æ–‡èŒƒå›´é¢„æµ‹ï¼ˆ150 turns æµ‹è¯•è¿è¡Œï¼‰
- âœ… é˜¶æ®µ 3b: æ®µè½çº§æ‘˜è¦ï¼ˆ108 segmentsï¼Œ251KBï¼‰

**è¿›è¡Œä¸­**ï¼š
- ğŸ”„ é˜¶æ®µ 3c: äº‹ä»¶ç±»å‹æ ‡æ³¨

**å¾…å®Œæˆ**ï¼š
- â³ é˜¶æ®µ 3d: è½®æ¬¡çº§ç»“æ„åŒ–ç¬”è®°
- â³ é˜¶æ®µ 4: åŸºäºæ ‡ç­¾çš„æ£€ç´¢
- â³ é˜¶æ®µ 5-7: æ ¼å¼è½¬æ¢ + ç­”æ¡ˆç”Ÿæˆ + è¯„ä¼°

**å¾…å†³ç­–**ï¼š
- æ˜¯å¦ç»§ç»­å¤„ç† traj-0 å…¨éƒ¨ 912 turnsï¼ˆæˆæœ¬ ~Â¥0.40ï¼‰
- è¿˜æ˜¯åˆ‡æ¢åˆ° Small æ•°æ®é›† traj-8ï¼ˆæˆæœ¬ ~Â¥0.05ï¼‰è¿›è¡Œå¿«é€ŸéªŒè¯

---

## å¸¸è§é—®é¢˜ FAQ

### Q1: ä¸ºä»€ä¹ˆä½¿ç”¨ Protocol Buffersï¼Ÿ

**åŸå› **ï¼šé¡¹ç›®éœ€è¦åœ¨å¤šä¸ªæ¨¡å—é—´ä¼ é€’å¤æ‚æ•°æ®ç»“æ„ï¼Œprotobuf æä¾›ç±»å‹å®‰å…¨ã€è·¨è¯­è¨€å…¼å®¹å’Œé«˜æ•ˆåºåˆ—åŒ–ã€‚

### Q2: ä¸ºä»€ä¹ˆ Pipeline åˆ†è¿™ä¹ˆå¤šé˜¶æ®µï¼Ÿ

**åŸå› **ï¼šæ¯ä¸ªé˜¶æ®µäº§ç”Ÿä¸­é—´äº§ç‰©å¯ç‹¬ç«‹å¤ç”¨ï¼Œä¾¿äºè°ƒè¯•å’Œå¢é‡å¤„ç†ã€‚ä¾‹å¦‚é˜¶æ®µ 2 çš„å‘é‡ç¼–ç åªéœ€è¿è¡Œä¸€æ¬¡ï¼Œåç»­é˜¶æ®µå¯é‡å¤ä½¿ç”¨ã€‚

### Q3: STITCH ç›¸æ¯”ä¼ ç»Ÿ RAG çš„ä¼˜åŠ¿ï¼Ÿ

**ä¼ ç»Ÿ RAG**ï¼šé—®é¢˜ â†’ å‘é‡æ£€ç´¢ â†’ è¿”å› top-k

**STITCH**ï¼šé—®é¢˜ â†’ LLM é¢„æµ‹æ ‡ç­¾ â†’ æ ‡ç­¾è¿‡æ»¤å€™é€‰é›† â†’ å‘é‡æ£€ç´¢ â†’ è¿”å› top-k

**ä¼˜åŠ¿**ï¼šåœ¨è¶…é•¿å¯¹è¯ï¼ˆ1000+ è½®ï¼‰ä¸­ï¼Œæ ‡ç­¾è¿‡æ»¤èƒ½å°†å€™é€‰é›†ä» 1000 é™è‡³ 50-100ï¼Œæ˜¾è‘—æå‡æ£€ç´¢ç²¾åº¦å’Œå¬å›ç‡ã€‚

### Q4: ä¸ºä»€ä¹ˆé˜¶æ®µ 3a/3b åªå¤„ç†äº† 150/912 turnsï¼Ÿ

**åŸå› **ï¼šæœªæ˜ç¡®ï¼Œå¯èƒ½æ˜¯ï¼š
1. ä¸­é€”é‡åˆ° API é™æµé”™è¯¯ï¼Œè§¦å‘ checkpoint ä¿å­˜åæå‰é€€å‡º
2. é…ç½®ä¸­å­˜åœ¨æœªå‘ç°çš„é‡‡æ ·å‚æ•°
3. ä»£ç é€»è¾‘ä¸­å­˜åœ¨æ—©åœæ¡ä»¶

**å»ºè®®**ï¼šåˆ‡æ¢åˆ° Small æ•°æ®é›†ï¼ˆtraj-8ï¼Œ62 turnsï¼‰è¿›è¡Œå®Œæ•´éªŒè¯ï¼Œå†å¤„ç†å¤§æ•°æ®é›†ã€‚

---

## æŠ€æœ¯è°ƒç ”æ–¹å‘

å½“é¡¹ç›®è·‘é€šåï¼Œéœ€è¦æ·±å…¥è°ƒç ”ä»¥ä¸‹æ–¹å‘ä»¥æ”¯æ’‘é¢è¯•ï¼š

1. **å¤šè½®å¯¹è¯ç”ŸæˆæŠ€æœ¯**
   - ä¸šç•Œä¸»æµæ–¹æ³•å¯¹æ¯”ï¼ˆSTITCH vs MemGPT vs Lettaï¼‰
   - é•¿æœŸè®°å¿†ç®¡ç†ç­–ç•¥

2. **æ„å›¾è¿½è¸ªä¸ä¸»é¢˜åˆ†å‰²**
   - å¯¹è¯ä¸»é¢˜è¾¹ç•Œæ£€æµ‹ç®—æ³•
   - ä¸Šä¸‹æ–‡èŒƒå›´é¢„æµ‹æ–¹æ³•

3. **æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰**
   - Dense retrieval vs Sparse retrieval
   - æ··åˆæ£€ç´¢ç­–ç•¥
   - æ ‡ç­¾è¾…åŠ©æ£€ç´¢çš„å­¦æœ¯è¿›å±•

4. **æ™ºèƒ½ä½“è®°å¿†ç³»ç»Ÿ**
   - çŸ­æœŸè®°å¿† vs é•¿æœŸè®°å¿†
   - è®°å¿†æ•´åˆä¸é—å¿˜æœºåˆ¶
   - åˆ†å±‚è®°å¿†æ¶æ„

---

## è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹ Qdrant å‘é‡åº“å†…å®¹

```bash
curl http://101.126.29.2:6333/collections/traj-0
```

### æŸ¥çœ‹ä¸­é—´äº§ç‰©

```bash
# æ•°æ®é›†æè¿°
cat stitch_output/traj-0/dataset_description.txt

# ä¸Šä¸‹æ–‡èŒƒå›´åˆ†é…
cat stitch_output/traj-0/context_scope_assignments.json | jq

# æ®µè½çº§æ‘˜è¦
cat stitch_output/traj-0/segment_level_notes.jsonl | jq -s
```

### ä¼°ç®—æˆæœ¬

æ¯ä¸ªé˜¶æ®µçš„ API è°ƒç”¨æ¬¡æ•°çº¦ç­‰äºå¯¹è¯è½®æ¬¡æ•°é‡ï¼ˆN turnsï¼‰ï¼Œqwen-plus ä»·æ ¼ï¼š
- è¾“å…¥ï¼šÂ¥0.004 / 1k tokens
- è¾“å‡ºï¼šÂ¥0.012 / 1k tokens

ä¼°ç®—å…¬å¼ï¼š`æˆæœ¬ â‰ˆ N * å¹³å‡ tokens * ä»·æ ¼`

---

## é‡è¦æé†’

1. **å…ˆç†è§£å†æ‰§è¡Œ**ï¼šæ¯ä¸ªé˜¶æ®µæ‰§è¡Œå‰ï¼Œå¿…é¡»ç†è§£å…¶è¾“å…¥è¾“å‡ºå’Œä½œç”¨
2. **æ£€æŸ¥ä¸­é—´äº§ç‰©**ï¼šæ¯ä¸ªé˜¶æ®µå®Œæˆåï¼Œæ£€æŸ¥ç”Ÿæˆçš„æ–‡ä»¶å†…å®¹æ˜¯å¦ç¬¦åˆé¢„æœŸ
3. **æˆæœ¬æ§åˆ¶**ï¼šä¼˜å…ˆç”¨ Small æ•°æ®é›†éªŒè¯å®Œæ•´ pipelineï¼Œå†å¤„ç†å¤§æ•°æ®é›†
4. **ä¿ç•™ç°åœº**ï¼šé‡åˆ°é”™è¯¯æ—¶ï¼Œä¿ç•™æ—¥å¿—å’Œä¸­é—´æ–‡ä»¶ï¼Œä¾¿äºåˆ†ææ ¹å› 
5. **éµå¾ªæŒ‡ä»¤**ï¼šä¸¥æ ¼éµå®ˆæœ¬æ–‡ä»¶å¼€å¤´çš„"ç”¨æˆ·ç‰¹å®šæŒ‡ä»¤"

---

## å®è·µè¿›åº¦è®°å½•

### 2026-02-13ï¼šå®Œæ•´ Pipeline è·‘é€š âœ…

#### å®Œæˆçš„å·¥ä½œ

**1. ç¯å¢ƒé…ç½®ä¸ä¼˜åŒ–**
- âœ… é…ç½®ç¯å¢ƒå˜é‡ç®¡ç†ï¼šåœ¨ `.env` ä¸­æ·»åŠ  `DATASET_NAME=traj-8`
- âœ… æ‰¹é‡æ›¿æ¢é…ç½®æ–‡ä»¶ï¼š9 ä¸ªé…ç½®æ–‡ä»¶å…¨éƒ¨ä½¿ç”¨ `${DATASET_NAME}` åŠ¨æ€å¼•ç”¨
- âœ… ä¼˜åŠ¿ï¼šåˆ‡æ¢æ•°æ®é›†åªéœ€ä¿®æ”¹ `.env` ä¸­ä¸€è¡Œ

**2. STITCH å®Œæ•´ Pipeline æ‰§è¡Œï¼ˆtraj-8ï¼‰**

| é˜¶æ®µ | ä»»åŠ¡ | è¾“å‡ºæ–‡ä»¶ | è€—æ—¶ | æˆæœ¬ |
|------|------|---------|------|------|
| é˜¶æ®µ 2 | å‘é‡ç¼–ç  | 62 turns â†’ Qdrant | ~2 åˆ†é’Ÿ | Â¥0.003 |
| é˜¶æ®µ 1 | æ•°æ®é›†æè¿° | dataset_description.txt (587B) | ~30 ç§’ | Â¥0.005 |
| é˜¶æ®µ 3a | ä¸Šä¸‹æ–‡èŒƒå›´é¢„æµ‹ | context_scope_assignments.json (5.7KB) | ~8 åˆ†é’Ÿ | Â¥0.02 |
| é˜¶æ®µ 3b | æ®µè½çº§æ‘˜è¦ | segment_level_notes.jsonl (102KB, 52 segments) | ~5 åˆ†é’Ÿ | Â¥0.01 |
| é˜¶æ®µ 3c | äº‹ä»¶ç±»å‹æ ‡æ³¨ | event_type_assignments.json (7.3KB, 10 æ ‡ç­¾) | ~10 åˆ†é’Ÿ | Â¥0.03 |
| é˜¶æ®µ 3d | ç»“æ„åŒ–ç¬”è®° | structured_turn_notes.jsonl (48KB, 62 notes) | ~8 åˆ†é’Ÿ | Â¥0.02 |
| é˜¶æ®µ 4 | æ ‡ç­¾æ£€ç´¢ | label_based_retrieval.json (217KB) | ~3 åˆ†é’Ÿ | Â¥0.01 |
| é˜¶æ®µ 5 | æ ¼å¼è½¬æ¢ | label_based_retrieval_transformed.json (148KB) | ~10 ç§’ | Â¥0 |
| é˜¶æ®µ 6 | ç­”æ¡ˆç”Ÿæˆ | answer_generation/direct_answer_generation.json | ~2 åˆ†é’Ÿ | Â¥0.02 |
| é˜¶æ®µ 7 | ç­”æ¡ˆè¯„ä¼° | answer_evaluation/answer_evaluation_v1.json | ~2 åˆ†é’Ÿ | Â¥0.02 |

**æ€»è€—æ—¶**ï¼šçº¦ 40 åˆ†é’Ÿ
**æ€»æˆæœ¬**ï¼šçº¦ Â¥0.12 RMB

**3. ä¿®å¤çš„æŠ€æœ¯é—®é¢˜**

| é—®é¢˜ | ç—‡çŠ¶ | è§£å†³æ–¹æ¡ˆ | æ–‡ä»¶ä½ç½® |
|------|------|---------|---------|
| Unicode ç¼–ç  | `UnicodeDecodeError: 'gbk'` | æ·»åŠ  `encoding='utf-8'` | `came_bench/utils/io.py:156,158,168,170` |
| Proto å¯¼å…¥è·¯å¾„ | `ModuleNotFoundError: No module named 'src'` | æ”¹ä¸º `from came_bench.proto import` | `method_stitch/dataset_process/encode_turns.py:28-32` |
| load_turns() ç­¾å | `TypeError: takes 1 argument but 2 were given` | åˆ é™¤ `dataset_name` å‚æ•° | 4 ä¸ªæ–‡ä»¶ï¼ˆè§ä¸Šæ–¹åˆ—è¡¨ï¼‰ |
| DashScope é™æµ | `429 Too Many Requests` | `max_concurrent` ä» 16 é™è‡³ 4 | `config/encode_config.json` |
| Embedding æ‰¹é‡é™åˆ¶ | `batch size invalid, should not be larger than 10` | `max_batch_size` ä» 128 é™è‡³ 10 | `method_stitch/label_based_context_retrieval.py:850` |
| ç¯å¢ƒå˜é‡æœªæ›¿æ¢ | `FileNotFoundError: ${DATASET_NAME}` | ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°ç»•è¿‡ | `transform_retrieval_output.py` |

#### è¯„ä¼°ç»“æœ

**traj-8 æ€§èƒ½ï¼ˆ6 ä¸ªé—®é¢˜ï¼‰**ï¼š
- å¹³å‡ Precision: **0.68** (68%)
- å¹³å‡ Recall: **0.66** (66%)
- å¹³å‡ F1: **0.64** (64%)
- å®Œå…¨æ­£ç¡®ç‡: **1/6** (16.7%)

**ä¸è®ºæ–‡åŸºå‡†å¯¹æ¯”**ï¼š

| æŒ‡æ ‡ | æˆ‘ä»¬çš„ç»“æœ (traj-8, 6 é—®é¢˜) | è®ºæ–‡ Small åŸºå‡† (144 é—®é¢˜) | å·®è· |
|------|---------------------------|-------------------------|------|
| Precision | 0.68 | 0.810 | -13% |
| F1 Score | 0.64 | 0.844 | -20% |

**å·®è·åŸå› åˆ†æ**ï¼š
1. **æ ·æœ¬é‡å°**ï¼š6 ä¸ªé—®é¢˜ vs 144 ä¸ªé—®é¢˜ï¼ˆè®ºæ–‡ Small å…¨é›†ï¼‰
2. **æ¨¡å‹å·®å¼‚**ï¼šqwen-plus vs GPT-5-mini (è®ºæ–‡ä½¿ç”¨)
3. **Prompt æœªè°ƒä¼˜**ï¼šä½¿ç”¨é»˜è®¤é…ç½®é¦–æ¬¡è¿è¡Œ
4. **æ•°æ®é›†è§„æ¨¡å°**ï¼štraj-8 åªæœ‰ 62 turnsï¼ˆSmall å­é›†ä¸­æœ€å°ï¼‰

#### æ ¸å¿ƒæ”¶è·

**1. è®ºæ–‡æ•°æ®é›†ç»“æ„ç†è§£ï¼ˆé‡è¦ä¿®æ­£ï¼‰**

ä»è®ºæ–‡è·å–çš„å‡†ç¡®ä¿¡æ¯ï¼š

| å­é›† | é—®é¢˜æ•° | Trajectories | å¹³å‡ Tokens | STITCH F1 | æœ€å¼º Baseline F1 | æå‡ |
|------|--------|--------------|-------------|-----------|----------------|------|
| Small | 144 | 6 ä¸ª | 23k | **0.844** | 0.804 | +5.0% |
| Medium | 168 | 6 ä¸ª | 137k | **0.682** | 0.566 | +11.6% |
| Large | 61 | 2 ä¸ª | 408k | **0.592** | 0.212 | **+35.6%** |

**å…³é”®å‘ç°**ï¼š
- traj-8 æ˜¯ Small å­é›†çš„ 6 ä¸ª trajectories ä¹‹ä¸€
- Small å­é›†æ€»å…±æœ‰ 144 ä¸ªé—®é¢˜ï¼Œä¸æ˜¯ 6 ä¸ª
- **è½¨è¿¹è¶Šé•¿ï¼ŒSTITCH ä¼˜åŠ¿è¶Šæ˜æ˜¾**ï¼ˆLarge æå‡æœ€å¤§ï¼š35.6%ï¼‰

**2. STITCH æ ¸å¿ƒæœºåˆ¶éªŒè¯**

âœ… **æ ‡ç­¾è¿‡æ»¤æœ‰æ•ˆæ€§**ï¼š
- æ£€ç´¢å‰ï¼š62 ä¸ªå€™é€‰è½®æ¬¡
- æ ‡ç­¾è¿‡æ»¤åï¼š12-31 ä¸ªå€™é€‰è½®æ¬¡
- å‹ç¼©ç‡ï¼š50%-80%

âœ… **æ ‡ç­¾ç±»å‹å‡†ç¡®è¯†åˆ«**ï¼š
- è§’è‰²è¿‡æ»¤ï¼šæ­£ç¡®åŒºåˆ† pro/con æ–¹
- äº‹ä»¶ç±»å‹ï¼š`Source-Based_Argument`ã€`AI_Risk_Claim`ã€`Disagreement` ç­‰
- ä¸Šä¸‹æ–‡èŒƒå›´ï¼š10 ä¸ª scope æ ‡ç­¾ï¼ˆå¦‚ `medical_research_acceleration`ï¼‰

âœ… **ç»“æ„åŒ–ç¬”è®°ç”Ÿæˆ**ï¼š
- æ¯ä¸ªè½®æ¬¡åŒ…å«ï¼š`act`ï¼ˆè¡Œä¸ºï¼‰ã€`target`ï¼ˆç›®æ ‡ï¼‰ã€`context_scope`ã€`event_types`
- ç¤ºä¾‹ï¼š`act=AssertBenefit, target=AI-driven medical research, scope=medical_research_acceleration`

**3. å·¥ç¨‹å®è·µèƒ½åŠ›**

âœ… **ç¯å¢ƒæ­å»º**ï¼š
- Python è™šæ‹Ÿç¯å¢ƒ
- Protocol Buffers ç¼–è¯‘
- Qdrant å‘é‡æ•°æ®åº“ï¼ˆäº‘ç«¯éƒ¨ç½²ï¼‰
- DashScope API é›†æˆ

âœ… **é…ç½®ç®¡ç†**ï¼š
- 9 ä¸ªé…ç½®æ–‡ä»¶çš„åˆ›å»ºå’Œç®¡ç†
- ç¯å¢ƒå˜é‡ç»Ÿä¸€ç®¡ç†ï¼ˆå•ä¸€æ•°æ®æºï¼‰

âœ… **é—®é¢˜æ’æŸ¥**ï¼š
- ç‹¬ç«‹å®šä½å’Œä¿®å¤ 6 ä¸ªæŠ€æœ¯é—®é¢˜
- ç†è§£é”™è¯¯æ ¹å› ï¼ˆç¼–ç ã€API é™åˆ¶ã€å‡½æ•°ç­¾åï¼‰

âœ… **æˆæœ¬æ§åˆ¶æ„è¯†**ï¼š
- ä¼˜å…ˆä½¿ç”¨ Small æ•°æ®é›†éªŒè¯ï¼ˆÂ¥0.12 vs Â¥0.40ï¼‰
- è¯†åˆ« API é™æµé—®é¢˜å¹¶è°ƒæ•´å¹¶å‘åº¦

#### é¢è¯•å‡†å¤‡è¦ç‚¹

**1. æŠ€æœ¯æ·±åº¦å±•ç¤º**

**é—®é¢˜**ï¼šSTITCH ä¸ä¼ ç»Ÿ RAG çš„æ ¸å¿ƒå·®å¼‚æ˜¯ä»€ä¹ˆï¼Ÿ

**å›ç­”è¦ç‚¹**ï¼š
- ä¼ ç»Ÿ RAGï¼šçº¯å‘é‡æ£€ç´¢ â†’ åœ¨è¶…é•¿å¯¹è¯ä¸­å™ªå£°å¤ªå¤š
- STITCHï¼šæ ‡ç­¾è¿‡æ»¤ + å‘é‡æ£€ç´¢ â†’ å€™é€‰é›†å‹ç¼© 50%-80%
- æ•°æ®æ”¯æ’‘ï¼šè®ºæ–‡æ˜¾ç¤ºåœ¨ Large å­é›†ï¼ˆ408k tokensï¼‰ï¼ŒSTITCH æ¯”æœ€å¼º baseline é«˜å‡º **35.6%**
- æˆ‘çš„å®éªŒéªŒè¯ï¼š62 turns â†’ 12-31 turnsï¼ˆæ ‡ç­¾è¿‡æ»¤æœ‰æ•ˆï¼‰

**2. å·¥ç¨‹èƒ½åŠ›å±•ç¤º**

**é¡¹ç›®äº®ç‚¹**ï¼š
- âœ… ç‹¬ç«‹è·‘é€š 7 ä¸ªé˜¶æ®µçš„å®Œæ•´ pipeline
- âœ… è§£å†³ 6 ä¸ªæŠ€æœ¯é—®é¢˜ï¼ˆç¼–ç ã€APIã€é…ç½®ï¼‰
- âœ… æˆæœ¬æ§åˆ¶ï¼šç”¨ Small æ•°æ®é›†éªŒè¯ï¼ˆÂ¥0.12ï¼‰
- âœ… é…ç½®ä¼˜åŒ–ï¼šç¯å¢ƒå˜é‡ç»Ÿä¸€ç®¡ç†

**3. å­¦ä¹ èƒ½åŠ›å±•ç¤º**

**å­¦ä¹ è·¯å¾„**ï¼š
1. é˜…è¯»è®ºæ–‡ç†è§£æ ¸å¿ƒæ€æƒ³
2. åˆ†æä»£ç ç†è§£å®ç°ç»†èŠ‚
3. é€é˜¶æ®µè¿è¡Œç†è§£æ•°æ®æµ
4. å¯¹æ¯”è®ºæ–‡åŸºå‡†åˆ†æå·®è·
5. è¯†åˆ«ä¼˜åŒ–æ–¹å‘ï¼ˆæ ·æœ¬é‡ã€æ¨¡å‹ã€Promptï¼‰

#### åç»­ä¼˜åŒ–æ–¹å‘

**çŸ­æœŸï¼ˆ1-2 å¤©ï¼‰**ï¼š
1. è¿è¡Œ Small å…¨é›†ï¼ˆ6 ä¸ª trajectoriesï¼Œ144 é—®é¢˜ï¼‰
2. å¯¹æ¯” traj-8 å’Œ Small å…¨é›†çš„æ€§èƒ½å·®å¼‚
3. åˆ†æå“ªäº›é—®é¢˜ç±»å‹ï¼ˆå¢é‡è®°å¿†ã€äº‹å®å›å¿†ã€å¤šè·³æ¨ç†ã€ä¿¡æ¯ç»¼åˆï¼‰æ›´å®¹æ˜“/å›°éš¾

**ä¸­æœŸï¼ˆ3-7 å¤©ï¼‰**ï¼š
1. å°è¯• Medium å­é›†ï¼ˆ168 é—®é¢˜ï¼Œ137k tokensï¼‰
2. éªŒè¯"è½¨è¿¹è¶Šé•¿ï¼Œä¼˜åŠ¿è¶Šæ˜æ˜¾"çš„è®ºæ–‡ç»“è®º
3. å¯¹æ¯”å®éªŒï¼šè¿è¡Œä¼ ç»Ÿ RAG baseline

**æŠ€æœ¯è°ƒç ”æ–¹å‘**ï¼š
1. **å¤šè½®å¯¹è¯è®°å¿†ç³»ç»Ÿ**ï¼šMemGPTã€Lettaã€STITCH çš„å¯¹æ¯”
2. **æ„å›¾è¿½è¸ªæŠ€æœ¯**ï¼šå¯¹è¯ä¸»é¢˜è¾¹ç•Œæ£€æµ‹ç®—æ³•
3. **æ··åˆæ£€ç´¢ç­–ç•¥**ï¼šDense + Sparse + Label-based
4. **æ™ºèƒ½ä½“è®°å¿†æ¶æ„**ï¼šçŸ­æœŸè®°å¿† vs é•¿æœŸè®°å¿†

#### å…³é”®é—®é¢˜ä¸æ€è€ƒ

**Q1ï¼šä¸ºä»€ä¹ˆ 62 turns â†’ 52 segmentsï¼Ÿ**
- ç›¸åŒ scope çš„è¿ç»­ turns è¢«åˆå¹¶æˆä¸€ä¸ª segment
- 10 ä¸ª turns è¢«åˆå¹¶ï¼ˆçº¦ 5 ç»„ï¼Œæ¯ç»„ 2-3 turnsï¼‰
- ä¼˜ç‚¹ï¼šä¿¡æ¯å‹ç¼©ï¼Œä¿æŒä¸»é¢˜å®Œæ•´æ€§

**Q2ï¼šä¸ºä»€ä¹ˆéœ€è¦ 4 ä¸ªå­é˜¶æ®µï¼ˆ3a/3b/3c/3dï¼‰ï¼Ÿ**
- 3aï¼šä¸Šä¸‹æ–‡èŒƒå›´ï¼ˆä¸»é¢˜åˆ†å‰²ï¼‰
- 3bï¼šæ®µè½çº§æ‘˜è¦ï¼ˆä¸­ç­‰ç²’åº¦ï¼‰
- 3cï¼šäº‹ä»¶ç±»å‹ï¼ˆå¯¹è¯è¡Œä¸ºæ ‡æ³¨ï¼‰
- 3dï¼šç»“æ„åŒ–ç¬”è®°ï¼ˆæ•´åˆæ‰€æœ‰æ ‡æ³¨ï¼‰
- åŸå› ï¼šå±‚æ¬¡åŒ–æ ‡æ³¨ï¼Œæ¯å±‚æä¾›ä¸åŒç²’åº¦çš„æ£€ç´¢ä¿¡å·

**Q3ï¼štransform_retrieval_output ä¸ºä»€ä¹ˆä¸æ”¯æŒç¯å¢ƒå˜é‡ï¼Ÿ**
- è¯¥è„šæœ¬ä½¿ç”¨æ™®é€š `json.load()` è€Œé `came_bench.utils.io.load_config()`
- åŸå› ï¼šå¯èƒ½æ˜¯å†å²é—ç•™ä»£ç ï¼Œæœªç»Ÿä¸€é…ç½®åŠ è½½é€»è¾‘
- è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°ç»•è¿‡

---

**æœ€åæ›´æ–°**ï¼š2026-02-13 18:30
**å½“å‰çŠ¶æ€**ï¼šâœ… traj-8 å®Œæ•´ pipeline å·²è·‘é€šï¼Œè¯„ä¼°å®Œæˆ

---

## è®ºæ–‡å¯¹é½æ”¹è¿›è®¡åˆ’

åŸºäºä¸è®ºæ–‡ [STITCH (arxiv.org/abs/2601.10702)](https://arxiv.org/abs/2601.10702) çš„å¯¹æ¯”åˆ†æï¼Œåˆ¶å®šä»¥ä¸‹æ”¹è¿›è®¡åˆ’ä»¥è´´è¿‘è®ºæ–‡å®éªŒè®¾ç½®ã€‚

### è®ºæ–‡å®éªŒè®¾ç½®æ¦‚è§ˆ

**1. æ•°æ®é›†ç»“æ„ï¼ˆå·²ç†è§£ï¼‰**

| å­é›† | é—®é¢˜æ•° | Trajectories | å¹³å‡ Tokens | STITCH F1 | æœ€å¼º Baseline F1 | æå‡å¹…åº¦ |
|------|--------|--------------|-------------|-----------|----------------|---------|
| Small | 144 | 6 ä¸ª (traj-8 è‡³ traj-13) | 23k | 0.844 | 0.804 | +5.0% |
| Medium | 168 | 6 ä¸ª (traj-2 è‡³ traj-7) | 137k | 0.682 | 0.566 | +11.6% |
| Large | 61 | 2 ä¸ª (traj-0, traj-1) | 408k | 0.592 | 0.212 | **+35.6%** |

**2. è®ºæ–‡ä½¿ç”¨çš„ 13 ä¸ª Baseline æ–¹æ³•**

| ç±»åˆ« | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| **é•¿ä¸Šä¸‹æ–‡ LLM** (5) | Full-context GPT-5-mini, Gemini 2.0 Flash Thinking, DeepSeek-v3, Claude Sonnet 3.7, Claude Haiku 3.5 | ç›´æ¥å°†å…¨éƒ¨å¯¹è¯å¡å…¥ contextï¼ˆæµ‹è¯•ä¸Šä¸‹æ–‡çª—å£èƒ½åŠ›ï¼‰|
| **åµŒå…¥å¼ RAG** (3) | Qwen 8B, text-embedding-3-small, text-embedding-3-large | **ä¼ ç»Ÿå‘é‡æ£€ç´¢æ–¹æ³•**ï¼ˆæˆ‘ä»¬éœ€è¦é‡ç‚¹å¯¹æ¯”ï¼‰|
| **ç»“æ„åŒ–è®°å¿†æ™ºèƒ½ä½“** (5) | Letta, MemGPT, Reflexion, ReAct, CoT | æ™ºèƒ½ä½“è®°å¿†ç®¡ç†ç³»ç»Ÿ |

**3. è®ºæ–‡ç»Ÿä¸€å®éªŒçº¦æŸ**

- **LLM ä¸»å¹²**ï¼šGPT-5-miniï¼ˆç­”æ¡ˆç”Ÿæˆ + æ ‡ç­¾é€‰æ‹©ï¼‰
- **ä¸Šä¸‹æ–‡é™åˆ¶**ï¼š4096 tokensï¼ˆç¡®ä¿å…¬å¹³å¯¹æ¯”ï¼Œé¿å…é•¿ä¸Šä¸‹æ–‡æ¨¡å‹ä½œå¼Šï¼‰
- **æ£€ç´¢å‚æ•°**ï¼šk_retrieve = 40ï¼ˆæˆ‘ä»¬å½“å‰æ˜¯ 20ï¼‰
- **è¯„ä¼°æ ‡å‡†**ï¼šMacro-averaged Precision, Recall, F1ï¼ˆå¤šå…ƒç´ ç­”æ¡ˆï¼‰

### æ”¹è¿›ä¼˜å…ˆçº§

#### ğŸ¯ Priority 1: å®ç°ä¼ ç»Ÿ RAG Baselineï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰

**ç›®æ ‡**ï¼šå®ç°è®ºæ–‡ä¸­çš„åµŒå…¥å¼ RAG æ–¹æ³•ï¼Œç”¨äºå¯¹æ¯”å®éªŒ

**ä¸ºä»€ä¹ˆé‡è¦**ï¼š
- è®ºæ–‡æ ¸å¿ƒè´¡çŒ®æ˜¯è¯æ˜ STITCH ä¼˜äºä¼ ç»Ÿ RAGï¼ˆSmall å­é›† +5%, Medium +11.6%, Large +35.6%ï¼‰
- æˆ‘ä»¬éœ€è¦éªŒè¯è¿™ä¸ªç»“è®ºï¼Œå±•ç¤ºæ ‡ç­¾è¿‡æ»¤çš„å®é™…æ•ˆæœ
- é¢è¯•æ—¶èƒ½å¤Ÿå±•ç¤º"å¯¹æ¯”å®éªŒè®¾è®¡èƒ½åŠ›"

**å®ç°æ–¹æ¡ˆ**ï¼š

**æ–¹æ¡ˆ Aï¼šè·³è¿‡é˜¶æ®µ 3ï¼ˆæ¨èï¼‰**

```bash
# å¤ç”¨å·²æœ‰çš„å‘é‡ç¼–ç ï¼ˆé˜¶æ®µ 2ï¼‰
# ç›´æ¥è¿è¡Œçº¯å‘é‡æ£€ç´¢

# æ–°å»ºé…ç½®æ–‡ä»¶ï¼šconfig/vanilla_rag_retrieval_config.json
{
  "structured_notes_jsonl_path": "stitch_output/${DATASET_NAME}/structured_turn_notes.jsonl",  // åªç”¨æ¥è·å– turn åˆ—è¡¨
  "questions_jsonl_path": "came_bench_data/decoded/${DATASET_NAME}/questions.jsonl",
  "output_json_path": "stitch_output/${DATASET_NAME}/vanilla_rag_retrieval.json",
  "embedding_topk": 40,  // è®ºæ–‡è®¾ç½®
  "skip_label_filtering": true,  // å…³é”®ï¼šè·³è¿‡æ ‡ç­¾è¿‡æ»¤
  "qdrant_config_turn_collection": {
    "url": "${QDRANT_URL}",
    "collection": "${DATASET_NAME}",
    "vector_size": 1024
  }
}
```

**ä»£ç ä¿®æ”¹ä½ç½®**ï¼š
- `method_stitch/label_based_context_retrieval.py`ï¼šæ·»åŠ  `skip_label_filtering` å‚æ•°
- å½“ `skip_label_filtering=true` æ—¶ï¼Œç›´æ¥å¯¹æ‰€æœ‰ 62 turns è¿›è¡Œå‘é‡æ£€ç´¢ï¼ˆä¸åšæ ‡ç­¾è¿‡æ»¤ï¼‰

**æ–¹æ¡ˆ Bï¼šä½¿ç”¨ came_bench çš„ RAG æ¥å£ï¼ˆå¦‚æœå­˜åœ¨ï¼‰**

æ£€æŸ¥ `came_bench/pipeline/retrieval/` æ˜¯å¦æœ‰ç°æˆçš„ RAG å®ç°ã€‚

**å®æ–½æ­¥éª¤**ï¼š
1. âœ… é˜…è¯» `method_stitch/label_based_context_retrieval.py` æºç ï¼ˆç†è§£æ£€ç´¢é€»è¾‘ï¼‰
2. â³ æ·»åŠ  `skip_label_filtering` å‚æ•°æ”¯æŒ
3. â³ åˆ›å»º `config/vanilla_rag_retrieval_config.json`
4. â³ è¿è¡Œå¯¹æ¯”å®éªŒï¼ˆSTITCH vs Vanilla RAGï¼‰
5. â³ åˆ†æå·®å¼‚ï¼šæ ‡ç­¾è¿‡æ»¤çš„å®é™…æ”¶ç›Š

**é¢„æœŸç»“æœ**ï¼š
- Vanilla RAG F1ï¼šçº¦ 0.50-0.60ï¼ˆæ ¹æ®è®ºæ–‡ Small å­é›†åŸºå‡†ï¼‰
- STITCH F1ï¼šçº¦ 0.64ï¼ˆæˆ‘ä»¬å½“å‰ç»“æœï¼‰
- å·®è·ï¼šçº¦ +5-10%ï¼ˆéªŒè¯è®ºæ–‡ç»“è®ºï¼‰

**æˆæœ¬ä¼°ç®—**ï¼š
- è¿è¡Œ Vanilla RAGï¼ˆ6 ä¸ªé—®é¢˜ï¼‰ï¼šçº¦ Â¥0.02ï¼ˆåªæœ‰æ£€ç´¢ï¼Œæ— éœ€é‡æ–°æ ‡æ³¨ï¼‰
- å¯¹æ¯”å®éªŒæ€»æˆæœ¬ï¼šÂ¥0.02

---

#### ğŸ¯ Priority 2: è°ƒæ•´è¶…å‚æ•°å¯¹é½è®ºæ–‡ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰

**ç›®æ ‡**ï¼šå°† STITCH å‚æ•°è°ƒæ•´ä¸ºè®ºæ–‡è®¾ç½®ï¼Œè§‚å¯Ÿæ€§èƒ½å˜åŒ–

**å½“å‰é…ç½® vs è®ºæ–‡é…ç½®**ï¼š

| å‚æ•° | å½“å‰å€¼ | è®ºæ–‡å€¼ | å½±å“ |
|------|--------|--------|------|
| `k_retrieve` (embedding_topk) | 20 | 40 | æ£€ç´¢æ›´å¤šå€™é€‰ï¼Œæé«˜å¬å›ç‡ |
| `max_label_selected_turns` | 20 | 40 | æ ‡ç­¾è¿‡æ»¤ä¿ç•™æ›´å¤šå€™é€‰ |
| `context_token_limit` | æ— é™åˆ¶ | 4096 | é˜²æ­¢è¶…é•¿ context ä½œå¼Š |
| LLM ä¸»å¹² | qwen-plus | GPT-5-mini | æ¨¡å‹èƒ½åŠ›å·®å¼‚ |

**å®æ–½æ­¥éª¤**ï¼š

**Step 1ï¼šè°ƒæ•´æ£€ç´¢å‚æ•°**

ä¿®æ”¹ `config/label_based_context_retrieval_config.json`ï¼š
```json
{
  "max_label_selected_turns": 40,  // 20 â†’ 40
  "embedding_topk": 40               // 20 â†’ 40
}
```

**Step 2ï¼šæ·»åŠ ä¸Šä¸‹æ–‡é•¿åº¦é™åˆ¶**

ä¿®æ”¹ `config/transform_retrieval_output_config.json`ï¼š
```json
{
  "max_context_tokens": 4096  // æ–°å¢å‚æ•°
}
```

éœ€è¦åœ¨ `method_stitch/transform_retrieval_output.py` ä¸­æ·»åŠ æˆªæ–­é€»è¾‘ï¼š
```python
# ä¼ªä»£ç 
retrieved_turns = retrieval_result[:topk]
total_tokens = 0
filtered_turns = []
for turn in retrieved_turns:
    turn_tokens = count_tokens(turn.content)
    if total_tokens + turn_tokens <= 4096:
        filtered_turns.append(turn)
        total_tokens += turn_tokens
    else:
        break
```

**Step 3ï¼šé‡æ–°è¿è¡Œ Pipeline**

```bash
# åªéœ€é‡æ–°è¿è¡Œé˜¶æ®µ 4-7ï¼ˆå¤ç”¨é˜¶æ®µ 1-3 çš„æ ‡æ³¨ç»“æœï¼‰
python -m method_stitch.label_based_context_retrieval --config config/label_based_context_retrieval_config.json --overwrite
python -m method_stitch.transform_retrieval_output --config config/transform_retrieval_output_config.json
python -m method_stitch.run_answer_generator -c config/answer_generation_config.json
python -m method_stitch.run_answer_evaluator -c config/answer_evaluation_config.json
```

**é¢„æœŸç»“æœ**ï¼š
- F1 åˆ†æ•°å¯èƒ½ä» 0.64 æå‡åˆ° 0.68-0.72ï¼ˆæ›´æ¥è¿‘è®ºæ–‡ 0.844ï¼‰
- å¬å›ç‡æå‡ï¼ˆæ£€ç´¢æ›´å¤šç›¸å…³ turnsï¼‰
- ç²¾ç¡®ç‡å¯èƒ½ç•¥å¾®ä¸‹é™ï¼ˆå€™é€‰é›†å˜å¤§ï¼Œå™ªå£°å¢åŠ ï¼‰

**æˆæœ¬ä¼°ç®—**ï¼š
- é‡æ–°è¿è¡Œé˜¶æ®µ 4-7ï¼šçº¦ Â¥0.08

---

#### ğŸ¯ Priority 3: è¿ç§»åˆ° GPT-5-miniï¼ˆä½ä¼˜å…ˆçº§ï¼Œæˆæœ¬è€ƒé‡ï¼‰

**ç›®æ ‡**ï¼šä½¿ç”¨è®ºæ–‡ç›¸åŒçš„ LLM ä¸»å¹²ï¼Œæ¶ˆé™¤æ¨¡å‹å·®å¼‚

**å½“å‰æ¨¡å‹ vs è®ºæ–‡æ¨¡å‹**ï¼š

| ç»´åº¦ | qwen-plus (å½“å‰) | GPT-5-mini (è®ºæ–‡) |
|------|-----------------|------------------|
| **ä»·æ ¼** | Â¥0.004/1k è¾“å…¥, Â¥0.012/1k è¾“å‡º | Â¥0.012/1k è¾“å…¥, Â¥0.036/1k è¾“å‡º |
| **èƒ½åŠ›** | é€šç”¨å¯¹è¯æ¨¡å‹ | OpenAI æœ€æ–°æ¨ç†æ¨¡å‹ |
| **æˆæœ¬å·®è·** | traj-8 å®Œæ•´ pipeline: Â¥0.12 | é¢„ä¼°: Â¥0.36 (**+200%**) |

**å†³ç­–å»ºè®®**ï¼š

**ä¸æ¨èç«‹å³è¿ç§»çš„åŸå› **ï¼š
1. **æˆæœ¬é«˜**ï¼š3 å€ä»·æ ¼å·®è·
2. **æ”¶ç›Šä¸ç¡®å®š**ï¼šæ¨¡å‹å·®å¼‚ vs è¶…å‚æ•°å·®å¼‚ï¼Œå“ªä¸ªå½±å“æ›´å¤§ï¼Ÿ
3. **ä¼˜å…ˆçº§ä½**ï¼šå…ˆéªŒè¯ Priority 1 å’Œ 2 çš„æ”¹è¿›æ•ˆæœ

**è¿ç§»æ—¶æœº**ï¼š
- å®Œæˆ Priority 1 å’Œ 2 åï¼Œå¦‚æœæ€§èƒ½ä»æœ‰è¾ƒå¤§å·®è·ï¼ˆ>10%ï¼‰ï¼Œå†è€ƒè™‘è¿ç§»
- æˆ–è€…åªåœ¨ Small å…¨é›†ï¼ˆ144 é—®é¢˜ï¼‰çš„æœ€ç»ˆå®éªŒä¸­ä½¿ç”¨ GPT-5-mini

**å®æ–½æ­¥éª¤ï¼ˆå¦‚æœå†³å®šè¿ç§»ï¼‰**ï¼š

ä¿®æ”¹æ‰€æœ‰é…ç½®æ–‡ä»¶ä¸­çš„ `language_model_provider_config`ï¼š
```json
{
  "provider": "LANGUAGE_MODEL_PROVIDER_OPENAI",
  "model_name": "gpt-5-mini",  // æ”¹åŠ¨
  "openai_config": {
    "api_key": "${OPENAI_API_KEY}",  // æ”¹åŠ¨
    "api_base": "https://api.openai.com/v1"  // æ”¹åŠ¨
  }
}
```

éœ€è¦åœ¨ `.env` ä¸­æ·»åŠ ï¼š
```bash
OPENAI_API_KEY=sk-proj-...
```

---

#### ğŸ¯ Priority 4: è¿è¡Œ Small å…¨é›†ï¼ˆ144 é—®é¢˜ï¼‰

**ç›®æ ‡**ï¼šè¿è¡Œå®Œæ•´ Small å­é›†ï¼Œè·å¾—ç»Ÿè®¡æ˜¾è‘—æ€§ç»“æœ

**å½“å‰çŠ¶æ€ vs ç›®æ ‡**ï¼š

| ç»´åº¦ | å½“å‰ (traj-8) | ç›®æ ‡ (Small å…¨é›†) |
|------|--------------|------------------|
| **Trajectories** | 1 ä¸ª (traj-8) | 6 ä¸ª (traj-8 è‡³ traj-13) |
| **é—®é¢˜æ•°** | 6 | 144 |
| **ç»Ÿè®¡æ˜¾è‘—æ€§** | âŒ æ ·æœ¬é‡è¿‡å° | âœ… å¯ä¸è®ºæ–‡ç›´æ¥å¯¹æ¯” |
| **æˆæœ¬** | Â¥0.12 | çº¦ Â¥0.72 (6Ã—) |

**å®æ–½æ­¥éª¤**ï¼š

**æ–¹æ¡ˆ Aï¼šä¸²è¡Œè¿è¡Œ 6 ä¸ª trajectories**

```bash
# å¾ªç¯è¿è¡Œ
for traj in traj-8 traj-9 traj-10 traj-11 traj-12 traj-13; do
  export DATASET_NAME=$traj
  # è¿è¡Œå®Œæ•´ pipelineï¼ˆé˜¶æ®µ 1-7ï¼‰
  bash scripts/sample_run.sh
done

# æ±‡æ€» 6 ä¸ª trajectories çš„è¯„ä¼°ç»“æœ
python scripts/aggregate_evaluation.py \
  --input-dir stitch_output \
  --trajectories traj-8,traj-9,traj-10,traj-11,traj-12,traj-13 \
  --output small_subset_evaluation.json
```

**æ–¹æ¡ˆ Bï¼šå¹¶è¡Œè¿è¡Œï¼ˆå¦‚æœæœ‰å¤šä¸ª API Keyï¼‰**

ä½¿ç”¨ GNU Parallel æˆ– Python multiprocessing å¹¶è¡Œå¤„ç† 6 ä¸ª trajectoriesã€‚

**é¢„æœŸç»“æœ**ï¼š

| æŒ‡æ ‡ | é¢„æœŸç»“æœ (Small å…¨é›†) | è®ºæ–‡åŸºå‡† | å·®è· |
|------|---------------------|---------|------|
| Precision | 0.75-0.80 | 0.810 | -1% ~ -6% |
| F1 Score | 0.75-0.80 | 0.844 | -5% ~ -11% |

**æˆæœ¬ä¼°ç®—**ï¼š
- 6 ä¸ª trajectories Ã— Â¥0.12 = **Â¥0.72**
- å¦‚æœä½¿ç”¨ GPT-5-miniï¼š6 Ã— Â¥0.36 = **Â¥2.16**

**æ‰§è¡Œæ—¶æœº**ï¼š
- å®Œæˆ Priority 1 å’Œ 2 å
- ç”¨äºæœ€ç»ˆé¢è¯•å±•ç¤ºï¼ˆå®Œæ•´å®éªŒç»“æœï¼‰

---

### æ”¹è¿›è®¡åˆ’æ‰§è¡Œè·¯çº¿å›¾

**ç¬¬ä¸€é˜¶æ®µï¼šéªŒè¯ STITCH æ ¸å¿ƒä»·å€¼ï¼ˆ1-2 å¤©ï¼‰**

```
Priority 1: å®ç° Vanilla RAG Baseline
  â”œâ”€ ä¿®æ”¹ label_based_context_retrieval.pyï¼ˆæ·»åŠ  skip_label_filteringï¼‰
  â”œâ”€ è¿è¡Œå¯¹æ¯”å®éªŒï¼ˆSTITCH vs RAGï¼Œtraj-8ï¼‰
  â””â”€ åˆ†ææ ‡ç­¾è¿‡æ»¤çš„å®é™…æ”¶ç›Š

Priority 2: è°ƒæ•´è¶…å‚æ•°
  â”œâ”€ k_retrieve: 20 â†’ 40
  â”œâ”€ æ·»åŠ  4096 token é™åˆ¶
  â””â”€ é‡æ–°è¿è¡Œé˜¶æ®µ 4-7
```

**é¢„æœŸäº§å‡º**ï¼š
- âœ… å¯¹æ¯”å®éªŒæ•°æ®ï¼šSTITCH vs Vanilla RAGï¼ˆtraj-8ï¼‰
- âœ… éªŒè¯è®ºæ–‡ç»“è®ºï¼šæ ‡ç­¾è¿‡æ»¤æå‡æ£€ç´¢ç²¾åº¦
- âœ… è¶…å‚æ•°ä¼˜åŒ–æ•ˆæœåˆ†æ
- **æˆæœ¬**ï¼šçº¦ Â¥0.10

**ç¬¬äºŒé˜¶æ®µï¼šæ‰©å¤§å®éªŒè§„æ¨¡ï¼ˆ2-3 å¤©ï¼‰**

```
Priority 4: è¿è¡Œ Small å…¨é›†ï¼ˆ144 é—®é¢˜ï¼‰
  â”œâ”€ ä¸²è¡Œè¿è¡Œ traj-8 è‡³ traj-13ï¼ˆ6 ä¸ª trajectoriesï¼‰
  â”œâ”€ æ±‡æ€»è¯„ä¼°ç»“æœ
  â””â”€ ä¸è®ºæ–‡åŸºå‡†å¯¹æ¯”ï¼ˆ0.844 F1ï¼‰
```

**é¢„æœŸäº§å‡º**ï¼š
- âœ… å®Œæ•´ Small å­é›†å®éªŒç»“æœ
- âœ… ç»Ÿè®¡æ˜¾è‘—æ€§éªŒè¯
- âœ… é—®é¢˜ç±»å‹åˆ†æï¼ˆå“ªäº›é—®é¢˜ç±»å‹æ›´å®¹æ˜“/å›°éš¾ï¼‰
- **æˆæœ¬**ï¼šçº¦ Â¥0.72

**ç¬¬ä¸‰é˜¶æ®µï¼ˆå¯é€‰ï¼‰ï¼šæ¨¡å‹è¿ç§»ï¼ˆ3-5 å¤©ï¼‰**

```
Priority 3: è¿ç§»åˆ° GPT-5-mini
  â”œâ”€ ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ˆ9 ä¸ªï¼‰
  â”œâ”€ è¿è¡Œ Small å…¨é›†
  â””â”€ å¯¹æ¯” qwen-plus vs GPT-5-mini çš„æ€§èƒ½å·®å¼‚
```

**é¢„æœŸäº§å‡º**ï¼š
- âœ… æ¶ˆé™¤æ¨¡å‹å·®å¼‚
- âœ… æœ€æ¥è¿‘è®ºæ–‡è®¾ç½®çš„å®éªŒç»“æœ
- **æˆæœ¬**ï¼šçº¦ Â¥2.16

---

### æŠ€æœ¯è°ƒç ”æ–¹å‘ï¼ˆé…åˆå®éªŒï¼‰

åœ¨è¿è¡Œå®éªŒçš„åŒæ—¶,æ·±å…¥è°ƒç ”ä»¥ä¸‹æ–¹å‘ä»¥æ”¯æ’‘é¢è¯•:

**1. å¤šè½®å¯¹è¯è®°å¿†ç³»ç»Ÿå¯¹æ¯”**
- STITCH vs MemGPT vs Letta
- ä¸‰è€…çš„è®°å¿†ç®¡ç†ç­–ç•¥å·®å¼‚
- é€‚ç”¨åœºæ™¯åˆ†æ

**2. RAG æ£€ç´¢ç­–ç•¥æ¼”è¿›**
- Dense retrieval (çº¯å‘é‡)
- Sparse retrieval (BM25, TF-IDF)
- Hybrid retrieval (Dense + Sparse)
- **Label-based filtering + Dense retrieval (STITCH)**

**3. æ„å›¾è¿½è¸ªæŠ€æœ¯**
- å¯¹è¯ä¸»é¢˜è¾¹ç•Œæ£€æµ‹ç®—æ³•
- ä¸Šä¸‹æ–‡èŒƒå›´é¢„æµ‹æ–¹æ³•ï¼ˆSTITCH çš„ context_scopeï¼‰
- äº‹ä»¶ç±»å‹æ ‡æ³¨ï¼ˆSTITCH çš„ event_typesï¼‰

**4. è¯„ä¼°æŒ‡æ ‡è®¾è®¡**
- ä¸ºä»€ä¹ˆç”¨ Macro-averaged è€Œé Micro-averagedï¼Ÿ
- å¤šå…ƒç´ ç­”æ¡ˆçš„è¯„ä¼°æŒ‘æˆ˜
- Precision, Recall, F1 çš„æƒè¡¡

---

### é¢è¯•å‡†å¤‡é‡ç‚¹

åŸºäºå®éªŒç»“æœï¼Œå‡†å¤‡ä»¥ä¸‹é¢è¯•é—®ç­”ï¼š

**Q1ï¼šä½ å¦‚ä½•éªŒè¯ STITCH ä¼˜äºä¼ ç»Ÿ RAGï¼Ÿ**

**å›ç­”æ¡†æ¶**ï¼š
1. **å¯¹æ¯”å®éªŒè®¾è®¡**ï¼šå®ç° Vanilla RAG baselineï¼ˆçº¯å‘é‡æ£€ç´¢ top-40ï¼‰
2. **å®éªŒæ•°æ®**ï¼štraj-8ï¼ˆ62 turnsï¼Œ6 é—®é¢˜ï¼‰
   - STITCH F1: 0.64
   - Vanilla RAG F1: 0.55ï¼ˆé¢„ä¼°ï¼‰
   - æå‡ï¼š+16%
3. **æœºåˆ¶åˆ†æ**ï¼šæ ‡ç­¾è¿‡æ»¤å°†å€™é€‰é›†ä» 62 å‹ç¼©åˆ° 12-31ï¼ˆ50%-80%ï¼‰ï¼Œå‡å°‘å™ªå£°
4. **è®ºæ–‡éªŒè¯**ï¼šSmall å­é›† STITCH æ¯”æœ€å¼º baseline é«˜ 5%ï¼ŒMedium +11.6%ï¼ŒLarge +35.6%
5. **å…³é”®æ´å¯Ÿ**ï¼š**å¯¹è¯è¶Šé•¿ï¼ŒSTITCH ä¼˜åŠ¿è¶Šæ˜æ˜¾**ï¼ˆLarge å­é›†æå‡æœ€å¤§ï¼‰

**Q2ï¼šä½ åœ¨é¡¹ç›®ä¸­é‡åˆ°çš„æœ€å¤§æŠ€æœ¯æŒ‘æˆ˜æ˜¯ä»€ä¹ˆï¼Ÿ**

**å›ç­”æ¡†æ¶**ï¼š
1. **æŒ‘æˆ˜**ï¼šDashScope embedding API æ‰¹é‡å¤§å°é™åˆ¶ï¼ˆ10 vs é»˜è®¤ 128ï¼‰
2. **å®šä½è¿‡ç¨‹**ï¼šé˜¶æ®µ 4 æ ‡ç­¾æ£€ç´¢æ—¶æŠ¥é”™ `batch size invalid`
3. **è§£å†³æ–¹æ¡ˆ**ï¼šä¿®æ”¹ `label_based_context_retrieval.py:850`ï¼Œ`max_batch_size = 10`
4. **æ·±å±‚æ€è€ƒ**ï¼šAPI é™åˆ¶åæ˜ äº†äº‘æœåŠ¡å•†çš„æˆæœ¬æ§åˆ¶ç­–ç•¥
5. **å·¥ç¨‹å¯ç¤º**ï¼šç”Ÿäº§ç¯å¢ƒéœ€è¦å¤„ç†å„ç§ API é™åˆ¶ï¼Œè¦æœ‰é™çº§å’Œé‡è¯•æœºåˆ¶

**Q3ï¼šå¦‚ä½•ä¼˜åŒ– STITCH çš„æˆæœ¬å’Œå»¶è¿Ÿï¼Ÿ**

**å›ç­”æ¡†æ¶**ï¼š
1. **æˆæœ¬ä¼˜åŒ–**ï¼š
   - ä½¿ç”¨æ›´ä¾¿å®œçš„ LLMï¼ˆqwen-plus vs GPT-5-miniï¼ŒèŠ‚çœ 66%ï¼‰
   - è°ƒæ•´ `max_concurrent`ï¼ˆAPI å¹¶å‘åº¦ï¼‰
   - é˜¶æ®µ 2 å‘é‡ç¼–ç åªè¿è¡Œä¸€æ¬¡ï¼Œå¤ç”¨ç»“æœ
2. **å»¶è¿Ÿä¼˜åŒ–**ï¼š
   - æ ‡ç­¾è¿‡æ»¤å‡å°‘å‘é‡æ£€ç´¢èŒƒå›´ï¼ˆ62 â†’ 12-31ï¼‰
   - å¹¶è¡Œå¤„ç†å¤šä¸ªé—®é¢˜ï¼ˆé˜¶æ®µ 4-7ï¼‰
   - ä½¿ç”¨æ›´å¿«çš„ embedding æ¨¡å‹
3. **è´¨é‡ vs æˆæœ¬æƒè¡¡**ï¼š
   - Small æ•°æ®é›†å…ˆéªŒè¯ï¼ˆÂ¥0.12ï¼‰
   - ç¡®è®¤æ–¹æ³•å¯è¡Œåå†è·‘ Large æ•°æ®é›†ï¼ˆÂ¥0.40ï¼‰

---

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨

**ç«‹å³æ‰§è¡Œï¼ˆä»Šå¤©ï¼‰**ï¼š
1. âœ… æ›´æ–° PLAN.mdï¼ˆå½“å‰ä»»åŠ¡ï¼‰
2. â³ é˜…è¯» `method_stitch/label_based_context_retrieval.py` æºç 
3. â³ è®¾è®¡ `skip_label_filtering` å‚æ•°å®ç°æ–¹æ¡ˆ

**æ˜å¤©æ‰§è¡Œ**ï¼š
1. â³ å®ç° Vanilla RAG baseline
2. â³ è¿è¡Œå¯¹æ¯”å®éªŒï¼ˆSTITCH vs RAGï¼Œtraj-8ï¼‰
3. â³ è°ƒæ•´è¶…å‚æ•°ï¼ˆk=40, 4096 token limitï¼‰

**æœ¬å‘¨ç›®æ ‡**ï¼š
- âœ… å®Œæˆ Priority 1 å’Œ 2ï¼ˆå¯¹æ¯”å®éªŒ + è¶…å‚æ•°ä¼˜åŒ–ï¼‰
- âœ… å‡†å¤‡é¢è¯•é—®ç­”ï¼ˆåŸºäºå®éªŒæ•°æ®ï¼‰
- âœ… æŠ€æœ¯è°ƒç ”ï¼ˆRAG æ£€ç´¢ç­–ç•¥æ¼”è¿›ï¼‰

---

**æœ€åæ›´æ–°**ï¼š2026-02-13 19:00
**å½“å‰çŠ¶æ€**ï¼šâœ… æ”¹è¿›è®¡åˆ’å·²åˆ¶å®šï¼Œå‡†å¤‡å®æ–½ Priority 1
